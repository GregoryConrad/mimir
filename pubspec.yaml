name: mimir_workspace
repository: https://github.com/GregoryConrad/mimir
publish_to: none

environment:
  sdk: ^3.9.0

dev_dependencies:
  melos: ^7.4.0
  very_good_analysis: ^10.1.0

workspace:
  - packages/flutter_mimir
  - packages/flutter_mimir/example
  - packages/mimir
  - packages/mimir/example

melos:
  scripts:
    codegen:
      description: Run all codegen for the project.
      steps:
        - buf generate
        - cargo build # NOTE: invokes build.rs, which generates bindings.h
        - dart run packages/mimir/tool/ffigen.dart # NOTE: generates Dart sources from bindings.h

    test:
      description: Run unit tests for a specific package in this project.
      run: flutter test test
      packageFilters:
        dirExists: test
      exec:
        concurrency: 1
        failFast: true
